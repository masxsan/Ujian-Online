<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ujian Online Multi-Guru - SMP Negeri 2 Purwantoro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white py-6 shadow-lg">
        <div class="container mx-auto text-center px-4">
            <h1 class="text-2xl md:text-3xl font-bold mb-2">LATIHAN UJIAN TENGAH SEMESTER</h1>
            <h2 class="text-lg md:text-xl font-semibold mb-1">SMP NEGERI 2 PURWANTORO</h2>
            <p class="text-sm md:text-base opacity-90">TAHUN PELAJARAN 2025/2026</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="homePage" class="max-w-4xl mx-auto fade-in">
            <div class="text-center mb-12">
                <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
                <h3 class="text-3xl font-bold text-gray-800 mb-4">Sistem Ujian Online Multi-Guru</h3>
                <p class="text-gray-600 text-lg">Pilih peran Anda untuk melanjutkan</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Guru Card -->
                <div class="bg-white rounded-xl shadow-lg p-8 text-center hover:shadow-xl transition-shadow">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-3">Panel Guru</h4>
                    <p class="text-gray-600 mb-6">Login atau daftar akun guru untuk mengelola soal ujian</p>
                    <button onclick="showTeacherAuth()" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105">
                        Masuk sebagai Guru
                    </button>
                </div>
                
                <!-- Siswa Card -->
                <div class="bg-white rounded-xl shadow-lg p-8 text-center hover:shadow-xl transition-shadow">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                    <h4 class="text-xl font-bold text-gray-800 mb-3">Login Siswa</h4>
                    <p class="text-gray-600 mb-6">Pilih guru dan masuk untuk mengerjakan ujian online</p>
                    <button onclick="showStudentLogin()" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105">
                        Masuk sebagai Siswa
                    </button>
                </div>
            </div>
            
            <!-- System Status -->
            <div class="mt-12 bg-white rounded-xl shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="bg-purple-100 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800">Status Sistem Multi-Guru</h5>
                            <p class="text-gray-600" id="systemStatus">Memuat informasi sistem...</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-purple-600" id="teacherCount">0</div>
                        <div class="text-sm text-gray-500">Guru Terdaftar</div>
                    </div>
                </div>
            </div>

            <!-- Multi-User Info -->
            <div class="mt-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg p-6 border border-green-200">
                <div class="flex items-center">
                    <div class="bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mr-4">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h5 class="font-semibold text-green-800 mb-1">üë• Sistem Multi-Guru</h5>
                        <p class="text-green-700 text-sm">Setiap guru memiliki akun terpisah dengan soal dan nilai siswa masing-masing. Data tersimpan permanen di browser.</p>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-bold text-green-600" id="totalSystemData">0</div>
                        <div class="text-xs text-green-500">Total Data</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Authentication Page -->
        <div id="teacherAuthPage" class="hidden max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 fade-in">
            <div class="text-center mb-8">
                <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Akses Guru</h3>
                <p class="text-gray-600">Login atau daftar akun guru baru</p>
            </div>
            
            <!-- Tab Navigation -->
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button onclick="showAuthTab('login')" id="loginAuthTab" 
                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-green-600 text-white">
                    üîë Login
                </button>
                <button onclick="showAuthTab('register')" id="registerAuthTab"
                        class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-green-600 hover:bg-green-50">
                    üìù Daftar Baru
                </button>
            </div>
            
            <!-- Login Tab -->
            <div id="loginAuthTabContent" class="space-y-6">
                <form id="teacherLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username Guru</label>
                        <input type="text" id="loginUsername" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                               placeholder="Masukkan username"
                               autocomplete="username">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="loginPassword" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-12"
                                   placeholder="Masukkan password"
                                   autocomplete="current-password">
                            <button type="button" onclick="togglePasswordVisibility('loginPassword', 'loginToggleIcon')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="loginToggleIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                        Username atau password salah!
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105">
                        üîì Masuk ke Panel Guru
                    </button>
                </form>
            </div>
            
            <!-- Register Tab -->
            <div id="registerAuthTabContent" class="hidden space-y-6">
                <form id="teacherRegisterForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                        <input type="text" id="registerFullName" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                               placeholder="Contoh: Dr. Ahmad Susanto, S.Pd"
                               autocomplete="name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mata Pelajaran</label>
                        <select id="registerSubject" required 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all">
                            <option value="">-- Pilih Mata Pelajaran --</option>
                            <option value="Matematika">Matematika</option>
                            <option value="Bahasa Indonesia">Bahasa Indonesia</option>
                            <option value="Bahasa Inggris">Bahasa Inggris</option>
                            <option value="IPA">IPA (Ilmu Pengetahuan Alam)</option>
                            <option value="IPS">IPS (Ilmu Pengetahuan Sosial)</option>
                            <option value="PKn">PKn (Pendidikan Kewarganegaraan)</option>
                            <option value="Seni Budaya">Seni Budaya</option>
                            <option value="PJOK">PJOK (Pendidikan Jasmani)</option>
                            <option value="Prakarya">Prakarya</option>
                            <option value="Agama">Pendidikan Agama</option>
                            <option value="TIK">TIK (Teknologi Informasi)</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="registerUsername" required minlength="4"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                               placeholder="Username unik (min. 4 karakter)"
                               autocomplete="username">
                        <p class="text-xs text-gray-500 mt-1">Username akan digunakan siswa untuk memilih guru</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="registerPassword" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-12"
                                   placeholder="Password (min. 6 karakter)"
                                   autocomplete="new-password">
                            <button type="button" onclick="togglePasswordVisibility('registerPassword', 'registerToggleIcon')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="registerToggleIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
                        <div class="relative">
                            <input type="password" id="registerConfirmPassword" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent pr-12"
                                   placeholder="Ulangi password"
                                   autocomplete="new-password">
                            <button type="button" onclick="togglePasswordVisibility('registerConfirmPassword', 'confirmToggleIcon')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="confirmToggleIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="registerError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                        <!-- Error message will be inserted here -->
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg text-sm">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Akun guru akan tersimpan permanen di browser ini</span>
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105">
                        üìù Daftar Akun Guru
                    </button>
                </form>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <button onclick="showHome()" 
                        class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">
                    Kembali ke Beranda
                </button>
            </div>
        </div>

        <!-- Student Login Page -->
        <div id="studentLoginPage" class="hidden max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 fade-in">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Login Siswa</h3>
                <p class="text-gray-600">Pilih guru dan masukkan data untuk memulai ujian</p>
            </div>
            
            <form id="studentLoginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Guru</label>
                    <select id="selectedTeacher" required 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">-- Pilih Guru Anda --</option>
                    </select>
                    <div id="teacherInfo" class="hidden mt-2 p-3 bg-blue-50 rounded-lg">
                        <div class="text-sm text-blue-700">
                            <div class="font-medium" id="teacherInfoName"></div>
                            <div id="teacherInfoSubject"></div>
                            <div id="teacherInfoQuestions"></div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="studentName" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                           placeholder="Contoh: Ahmad Rizki Pratama"
                           autocomplete="off">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                    <select id="studentClass" required 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        <option value="">-- Pilih Kelas Anda --</option>
                        <option value="7A">Kelas 7A</option>
                        <option value="7B">Kelas 7B</option>
                        <option value="7C">Kelas 7C</option>
                        <option value="7D">Kelas 7D</option>
                        <option value="7E">Kelas 7E</option>
                        <option value="7F">Kelas 7F</option>
                        <option value="7G">Kelas 7G</option>
                        <option value="8A">Kelas 8A</option>
                        <option value="8B">Kelas 8B</option>
                        <option value="8C">Kelas 8C</option>
                        <option value="8D">Kelas 8D</option>
                        <option value="8E">Kelas 8E</option>
                        <option value="8F">Kelas 8F</option>
                        <option value="8G">Kelas 8G</option>
                        <option value="9A">Kelas 9A</option>
                        <option value="9B">Kelas 9B</option>
                        <option value="9C">Kelas 9C</option>
                        <option value="9D">Kelas 9D</option>
                        <option value="9E">Kelas 9E</option>
                        <option value="9F">Kelas 9F</option>
                        <option value="9G">Kelas 9G</option>
                    </select>
                </div>
                
                <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg text-sm">
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>Pastikan guru, nama, dan kelas sudah benar sebelum memulai ujian!</span>
                    </div>
                </div>
                
                <button type="submit" id="startStudentExamBtn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none">
                    üöÄ Mulai Ujian Sekarang
                </button>
            </form>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <button onclick="showHome()" 
                        class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">
                    Kembali ke Beranda
                </button>
            </div>
        </div>

        <!-- Teacher Panel -->
        <div id="teacherPanel" class="hidden max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 fade-in">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">Panel Guru</h3>
                    <p class="text-sm text-gray-600 mt-1" id="currentTeacherInfo">Loading...</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="showChangePassword()" 
                            class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-colors">
                        üîê Ganti Password
                    </button>
                    <button onclick="showHeaderEditor()" 
                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                        ‚öôÔ∏è Edit Header
                    </button>
                    <button onclick="logoutTeacher()" 
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        üö™ Logout
                    </button>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Upload Soal -->
                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="text-xl font-semibold text-blue-800 mb-4">Upload Soal</h4>
                    
                    <!-- Tab Navigation -->
                    <div class="flex mb-4 bg-white rounded-lg p-1">
                        <button onclick="showUploadTab('file')" id="fileTab" 
                                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors bg-blue-600 text-white">
                            üìÅ Upload File
                        </button>
                        <button onclick="showUploadTab('manual')" id="manualTab"
                                class="flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors text-blue-600 hover:bg-blue-50">
                            ‚úèÔ∏è Input Manual
                        </button>
                    </div>
                    
                    <!-- File Upload Tab -->
                    <div id="fileUploadTab" class="space-y-4">
                        <div class="bg-white p-4 rounded-lg border-2 border-dashed border-blue-300">
                            <div class="text-center">
                                <svg class="w-12 h-12 text-blue-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="text-sm text-gray-600 mb-2">Upload file Microsoft Word (.docx)</p>
                                <input type="file" id="wordFile" accept=".docx,.doc,.txt" 
                                       class="hidden" onchange="handleFileUpload(event)">
                                <button onclick="document.getElementById('wordFile').click()" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    Pilih File
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 p-3 rounded-lg mb-3">
                            <h5 class="font-medium text-red-800 mb-2">‚ö†Ô∏è Peringatan:</h5>
                            <p class="text-sm text-red-700">Upload file akan <strong>mengganti semua soal lama</strong> dengan soal baru dari file!</p>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <h5 class="font-medium text-yellow-800 mb-2">üìã Format Template:</h5>
                            <div class="text-xs text-yellow-700 font-mono bg-yellow-100 p-2 rounded">
                                Komponen utama yang berfungsi sebagai otak komputer adalah ‚Ä¶<br>
                                A. RAM<br>
                                B. CPU<br>
                                C. Harddisk<br>
                                D. Monitor<br>
                                Kunci Jawaban B<br><br>
                                
                                Salah satu fungsi perangkat input adalah ‚Ä¶<br>
                                A. Menampilkan hasil<br>
                                B. Menyimpan data<br>
                                C. Memasukkan data<br>
                                D. Memproses data<br>
                                Kunci Jawaban C<br><br>
                                
                                ...dan seterusnya
                            </div>
                        </div>
                        
                        <button onclick="processUploadedFile()" id="processBtn" disabled
                                class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üì§ Proses File
                        </button>
                    </div>
                    
                    <!-- Manual Input Tab -->
                    <div id="manualInputTab" class="hidden space-y-4">
                        <form id="questionForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pertanyaan</label>
                                <textarea id="questionText" required rows="3"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Masukkan pertanyaan..."></textarea>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-700">Pilihan Jawaban</label>
                                <input type="text" id="optionA" required placeholder="A. " 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="text" id="optionB" required placeholder="B. " 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="text" id="optionC" required placeholder="C. " 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="text" id="optionD" required placeholder="D. " 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jawaban Benar</label>
                                <select id="correctAnswer" required 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih jawaban benar</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <button type="submit" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                    Tambah Soal
                                </button>
                                <button type="button" onclick="saveAllQuestions()"
                                        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                    üíæ Simpan Semua
                                </button>
                            </div>
                            
                            <div class="mt-4">
                                <button onclick="clearAllQuestions()" 
                                        class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    üóëÔ∏è Hapus Semua Soal
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Rekap Nilai -->
                <div class="bg-green-50 p-6 rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-xl font-semibold text-green-800">Rekap Nilai Siswa</h4>
                        <div class="text-sm text-green-600 font-medium" id="scoresCount">0 nilai tersimpan</div>
                    </div>
                    <div id="scoresList" class="space-y-3 max-h-96 overflow-y-auto">
                        <p class="text-gray-600 italic">Belum ada data nilai</p>
                    </div>
                    <div class="mt-4 space-y-2">
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="exportScoresJSON()" 
                                    class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                üìä Ekspor JSON
                            </button>
                            <button onclick="exportScoresExcel()" 
                                    class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                üìà Ekspor Excel
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mt-2">
                            <button onclick="backupTeacherData()" 
                                    class="bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                üíæ Backup Data
                            </button>
                            <button onclick="showRestoreModal()" 
                                    class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                üì• Restore Data
                            </button>
                        </div>
                        <button onclick="clearScores()" 
                                class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm mt-2">
                            üóëÔ∏è Hapus Semua Data
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Daftar Soal -->
            <div class="mt-8 bg-gray-50 p-6 rounded-lg">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">Daftar Soal</h4>
                <div id="questionsList" class="space-y-3">
                    <p class="text-gray-600 italic">Belum ada soal</p>
                </div>
            </div>
        </div>

        <!-- Exam Page -->
        <div id="examPage" class="hidden max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 fade-in">
            <div class="flex justify-between items-center mb-8">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">Ujian Online</h3>
                    <p class="text-gray-600" id="examStudentInfo"></p>
                    <p class="text-sm text-gray-500" id="examTeacherInfo"></p>
                </div>
                <div class="text-right">
                    <div class="bg-blue-100 px-4 py-2 rounded-lg">
                        <span class="text-sm text-blue-800 font-medium">Soal</span>
                        <span id="questionCounter" class="text-lg font-bold text-blue-900 ml-2">1/5</span>
                    </div>
                </div>
            </div>
            
            <div id="questionContainer" class="mb-8">
                <!-- Questions will be loaded here -->
            </div>
            
            <div class="flex justify-between">
                <button id="prevBtn" onclick="previousQuestion()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    ‚Üê Sebelumnya
                </button>
                <button id="nextBtn" onclick="nextQuestion()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                    Selanjutnya ‚Üí
                </button>
                <button id="submitBtn" onclick="submitExam()" 
                        class="hidden bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                    Kirim Jawaban
                </button>
            </div>
        </div>

        <!-- Result Page -->
        <div id="resultPage" class="hidden max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8 text-center fade-in">
            <div class="mb-8">
                <div class="bg-green-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-3xl font-bold text-gray-800 mb-2">Ujian Selesai!</h3>
                <p class="text-gray-600">Terima kasih telah mengerjakan ujian</p>
            </div>
            
            <div class="bg-blue-50 p-6 rounded-lg mb-8">
                <div id="finalScore" class="text-4xl font-bold text-blue-600 mb-2">85</div>
                <p class="text-gray-700 font-medium">Nilai Anda</p>
                <div id="scoreDetails" class="mt-4 text-sm text-gray-600">
                    Jawaban benar: 17 dari 20 soal
                </div>
                <div id="examResultInfo" class="mt-2 text-xs text-gray-500">
                    <!-- Teacher and subject info will be shown here -->
                </div>
            </div>
            
            <button onclick="showHome()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition-colors">
                Kembali ke Beranda
            </button>
        </div>

        <!-- Change Password Modal -->
        <div id="changePasswordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md mx-4 w-full">
                <div class="text-center mb-6">
                    <div class="bg-yellow-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Ganti Password</h3>
                    <p class="text-gray-600">Ubah password untuk keamanan akun guru</p>
                </div>
                
                <form id="changePasswordForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Lama</label>
                        <div class="relative">
                            <input type="password" id="oldPasswordInput" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent pr-12"
                                   placeholder="Masukkan password lama">
                            <button type="button" onclick="togglePasswordVisibility('oldPasswordInput', 'toggleIcon2')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="toggleIcon2" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
                        <div class="relative">
                            <input type="password" id="newPasswordInput" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent pr-12"
                                   placeholder="Masukkan password baru (min. 6 karakter)">
                            <button type="button" onclick="togglePasswordVisibility('newPasswordInput', 'toggleIcon3')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="toggleIcon3" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password Baru</label>
                        <div class="relative">
                            <input type="password" id="confirmPasswordInput" required minlength="6"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent pr-12"
                                   placeholder="Ulangi password baru">
                            <button type="button" onclick="togglePasswordVisibility('confirmPasswordInput', 'toggleIcon4')" 
                                    class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg id="toggleIcon4" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="passwordError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                        <!-- Error message will be inserted here -->
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" 
                                class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                            üîê Ganti Password
                        </button>
                        <button type="button" onclick="closeChangePassword()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Header Editor Modal -->
        <div id="headerEditorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md mx-4 w-full">
                <div class="text-center mb-6">
                    <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Edit Header Ujian</h3>
                    <p class="text-gray-600">Ubah informasi header yang ditampilkan</p>
                </div>
                
                <form id="headerForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Ujian</label>
                        <input type="text" id="examTitleInput" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="Contoh: LATIHAN UJIAN TENGAH SEMESTER">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Sekolah</label>
                        <input type="text" id="schoolNameInput" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="Contoh: SMP NEGERI 2 PURWANTORO">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tahun Pelajaran</label>
                        <input type="text" id="academicYearInput" required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="Contoh: TAHUN PELAJARAN 2025/2026">
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" 
                                class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üíæ Simpan
                        </button>
                        <button type="button" onclick="closeHeaderEditor()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Restore Data Modal -->
        <div id="restoreDataModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md mx-4 w-full">
                <div class="text-center mb-6">
                    <div class="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Restore Data Guru</h3>
                    <p class="text-gray-600">Upload file backup untuk mengembalikan data</p>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg border-2 border-dashed border-gray-300">
                        <div class="text-center">
                            <svg class="w-10 h-10 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-sm text-gray-600 mb-2">Pilih file backup (.json)</p>
                            <input type="file" id="restoreFile" accept=".json" 
                                   class="hidden" onchange="handleRestoreFile(event)">
                            <button onclick="document.getElementById('restoreFile').click()" 
                                    class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                Pilih File Backup
                            </button>
                        </div>
                    </div>
                    
                    <div id="restorePreview" class="hidden bg-blue-50 p-4 rounded-lg">
                        <h5 class="font-medium text-blue-800 mb-2">Preview Data:</h5>
                        <div id="restoreInfo" class="text-sm text-blue-700"></div>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button id="confirmRestoreBtn" onclick="confirmRestore()" disabled
                                class="flex-1 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            üì• Restore Data
                        </button>
                        <button onclick="closeRestoreModal()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Multi-User System Variables
        let teachers = JSON.parse(localStorage.getItem('teachers')) || {};
        let currentTeacher = null;
        let currentStudent = null;
        let currentExamData = null;
        
        // Exam Variables
        let uploadedFileContent = '';
        let studentAnswers = {};
        let currentQuestion = 0;
        let restoreData = null;
        
        // Header Settings (Global)
        let headerSettings = JSON.parse(localStorage.getItem('headerSettings')) || {
            examTitle: 'LATIHAN UJIAN TENGAH SEMESTER',
            schoolName: 'SMP NEGERI 2 PURWANTORO',
            academicYear: 'TAHUN PELAJARAN 2025/2026'
        };

        // Navigation Functions
        function showHome() {
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            updateHomeStatus();
        }

        function showTeacherAuth() {
            hideAllPages();
            document.getElementById('teacherAuthPage').classList.remove('hidden');
            showAuthTab('login'); // Default to login tab
        }

        function showStudentLogin() {
            hideAllPages();
            document.getElementById('studentLoginPage').classList.remove('hidden');
            updateTeacherOptions();
        }

        function showTeacherPanel() {
            hideAllPages();
            document.getElementById('teacherPanel').classList.remove('hidden');
            updateTeacherPanel();
        }

        function showExam() {
            hideAllPages();
            document.getElementById('examPage').classList.remove('hidden');
            loadQuestion();
        }

        function showResult() {
            hideAllPages();
            document.getElementById('resultPage').classList.remove('hidden');
        }

        function hideAllPages() {
            const pages = ['homePage', 'teacherAuthPage', 'studentLoginPage', 'teacherPanel', 'examPage', 'resultPage'];
            pages.forEach(pageId => {
                document.getElementById(pageId).classList.add('hidden');
            });
        }

        // Teacher Authentication Functions
        function showAuthTab(tabType) {
            const loginTab = document.getElementById('loginAuthTab');
            const registerTab = document.getElementById('registerAuthTab');
            const loginContent = document.getElementById('loginAuthTabContent');
            const registerContent = document.getElementById('registerAuthTabContent');
            
            if (tabType === 'login') {
                loginTab.classList.add('bg-green-600', 'text-white');
                loginTab.classList.remove('text-green-600', 'hover:bg-green-50');
                registerTab.classList.remove('bg-green-600', 'text-white');
                registerTab.classList.add('text-green-600', 'hover:bg-green-50');
                
                loginContent.classList.remove('hidden');
                registerContent.classList.add('hidden');
            } else {
                registerTab.classList.add('bg-green-600', 'text-white');
                registerTab.classList.remove('text-green-600', 'hover:bg-green-50');
                loginTab.classList.remove('bg-green-600', 'text-white');
                loginTab.classList.add('text-green-600', 'hover:bg-green-50');
                
                registerContent.classList.remove('hidden');
                loginContent.classList.add('hidden');
            }
        }

        // Teacher Login Handler
        document.getElementById('teacherLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!teachers[username]) {
                showLoginError('Username tidak ditemukan!');
                return;
            }
            
            if (teachers[username].password !== password) {
                showLoginError('Password salah!');
                return;
            }
            
            // Successful login
            currentTeacher = teachers[username];
            currentTeacher.lastLogin = new Date().toLocaleString('id-ID');
            
            // Update teacher data
            teachers[username] = currentTeacher;
            localStorage.setItem('teachers', JSON.stringify(teachers));
            
            showTeacherPanel();
            showSuccessMessage(`Selamat datang, ${currentTeacher.fullName}!`);
        });

        // Teacher Register Handler
        document.getElementById('teacherRegisterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('registerFullName').value.trim();
            const subject = document.getElementById('registerSubject').value;
            const username = document.getElementById('registerUsername').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                showRegisterError('Konfirmasi password tidak cocok!');
                return;
            }
            
            if (teachers[username]) {
                showRegisterError('Username sudah digunakan! Pilih username lain.');
                return;
            }
            
            // Create new teacher account
            const newTeacher = {
                username: username,
                fullName: fullName,
                subject: subject,
                password: password,
                createdAt: new Date().toLocaleString('id-ID'),
                lastLogin: null,
                questions: [],
                scores: []
            };
            
            teachers[username] = newTeacher;
            localStorage.setItem('teachers', JSON.stringify(teachers));
            
            // Auto login the new teacher
            currentTeacher = newTeacher;
            
            showTeacherPanel();
            showSuccessMessage(`Akun guru berhasil dibuat! Selamat datang, ${fullName}!`);
        });

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function showRegisterError(message) {
            const errorDiv = document.getElementById('registerError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        // Student Login Functions
        function updateTeacherOptions() {
            const select = document.getElementById('selectedTeacher');
            select.innerHTML = '<option value="">-- Pilih Guru Anda --</option>';
            
            Object.values(teachers).forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.username;
                option.textContent = `${teacher.fullName} - ${teacher.subject}`;
                select.appendChild(option);
            });
        }

        // Teacher selection change handler
        document.getElementById('selectedTeacher').addEventListener('change', function() {
            const selectedUsername = this.value;
            const teacherInfo = document.getElementById('teacherInfo');
            
            if (!selectedUsername) {
                teacherInfo.classList.add('hidden');
                return;
            }
            
            const teacher = teachers[selectedUsername];
            if (teacher) {
                document.getElementById('teacherInfoName').textContent = teacher.fullName;
                document.getElementById('teacherInfoSubject').textContent = `Mata Pelajaran: ${teacher.subject}`;
                document.getElementById('teacherInfoQuestions').textContent = `Soal tersedia: ${teacher.questions.length} soal`;
                teacherInfo.classList.remove('hidden');
            }
        });

        // Student Login Handler
        document.getElementById('studentLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedTeacherUsername = document.getElementById('selectedTeacher').value;
            const studentName = document.getElementById('studentName').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            
            if (!selectedTeacherUsername) {
                alert('Silakan pilih guru terlebih dahulu!');
                return;
            }
            
            const selectedTeacher = teachers[selectedTeacherUsername];
            if (!selectedTeacher || selectedTeacher.questions.length === 0) {
                alert('Guru yang dipilih belum memiliki soal ujian. Silakan pilih guru lain atau hubungi guru untuk mengupload soal.');
                return;
            }
            
            // Set current exam data
            currentStudent = {
                name: studentName,
                class: studentClass,
                teacher: selectedTeacher
            };
            
            currentExamData = {
                questions: [...selectedTeacher.questions], // Copy questions
                teacher: selectedTeacher
            };
            
            // Reset exam state
            currentQuestion = 0;
            studentAnswers = {};
            
            // Update exam info
            document.getElementById('examStudentInfo').textContent = `${studentName} - Kelas ${studentClass}`;
            document.getElementById('examTeacherInfo').textContent = `Guru: ${selectedTeacher.fullName} - ${selectedTeacher.subject}`;
            
            showSuccessMessage(`Selamat datang ${studentName}! Ujian dimulai dengan ${selectedTeacher.questions.length} soal.`);
            
            setTimeout(() => {
                showExam();
            }, 1000);
        });

        // Question Management Functions
        function loadQuestion() {
            if (!currentExamData || currentExamData.questions.length === 0) {
                alert('Tidak ada soal yang tersedia.');
                showStudentLogin();
                return;
            }

            const question = currentExamData.questions[currentQuestion];
            const container = document.getElementById('questionContainer');
            
            container.innerHTML = `
                <div class="slide-in">
                    <div class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Pertanyaan ${currentQuestion + 1}</h4>
                        <p class="text-gray-700 text-lg mb-6">${question.question}</p>
                        
                        <div class="space-y-3">
                            ${question.options.map((option, index) => `
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-blue-50 cursor-pointer transition-colors">
                                    <input type="radio" name="answer" value="${String.fromCharCode(65 + index)}" 
                                           class="mr-3 text-blue-600 focus:ring-blue-500" 
                                           ${studentAnswers[question.id] === String.fromCharCode(65 + index) ? 'checked' : ''}>
                                    <span class="text-gray-700">${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            // Update counter and buttons
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${currentExamData.questions.length}`;
            document.getElementById('prevBtn').disabled = currentQuestion === 0;
            
            if (currentQuestion === currentExamData.questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('submitBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('submitBtn').classList.add('hidden');
            }

            // Add event listeners for answers
            const radioButtons = container.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    studentAnswers[question.id] = this.value;
                });
            });
        }

        function nextQuestion() {
            if (currentQuestion < currentExamData.questions.length - 1) {
                currentQuestion++;
                loadQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion();
            }
        }

        function submitExam() {
            const correctAnswers = currentExamData.questions.filter(q => studentAnswers[q.id] === q.correct).length;
            const totalQuestions = currentExamData.questions.length;
            const score = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Create exam result
            const examResult = {
                id: Date.now(),
                studentName: currentStudent.name,
                studentClass: currentStudent.class,
                score: score,
                correctAnswers: correctAnswers,
                totalQuestions: totalQuestions,
                date: new Date().toLocaleString('id-ID'),
                timestamp: new Date().getTime(),
                teacherUsername: currentStudent.teacher.username,
                teacherName: currentStudent.teacher.fullName,
                subject: currentStudent.teacher.subject,
                answers: { ...studentAnswers }
            };
            
            // Save to teacher's scores
            const teacherUsername = currentStudent.teacher.username;
            if (teachers[teacherUsername]) {
                teachers[teacherUsername].scores.push(examResult);
                localStorage.setItem('teachers', JSON.stringify(teachers));
                console.log('‚úÖ Score saved to teacher:', teacherUsername);
            }
            
            // Show result
            document.getElementById('finalScore').textContent = score;
            document.getElementById('scoreDetails').textContent = `Jawaban benar: ${correctAnswers} dari ${totalQuestions} soal`;
            document.getElementById('examResultInfo').textContent = `Guru: ${currentStudent.teacher.fullName} - ${currentStudent.teacher.subject}`;
            
            showResult();
            showSuccessMessage('Nilai berhasil disimpan!');
        }

        // Teacher Panel Functions
        function updateTeacherPanel() {
            if (!currentTeacher) return;
            
            // Update teacher info
            document.getElementById('currentTeacherInfo').textContent = 
                `${currentTeacher.fullName} - ${currentTeacher.subject} | Login: ${currentTeacher.lastLogin || 'Pertama kali'}`;
            
            // Update questions and scores
            updateQuestionsList();
            updateScoresList();
        }

        // Question Form Handler
        document.getElementById('questionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentTeacher) return;
            
            const questionText = document.getElementById('questionText').value;
            const optionA = document.getElementById('optionA').value;
            const optionB = document.getElementById('optionB').value;
            const optionC = document.getElementById('optionC').value;
            const optionD = document.getElementById('optionD').value;
            const correctAnswer = document.getElementById('correctAnswer').value;
            
            const newQuestion = {
                id: Date.now(),
                question: questionText,
                options: [optionA, optionB, optionC, optionD],
                correct: correctAnswer
            };
            
            currentTeacher.questions.push(newQuestion);
            teachers[currentTeacher.username] = currentTeacher;
            localStorage.setItem('teachers', JSON.stringify(teachers));
            
            // Reset form
            this.reset();
            updateQuestionsList();
            
            showSuccessMessage('Soal berhasil ditambahkan!');
        });

        function updateQuestionsList() {
            if (!currentTeacher) return;
            
            const container = document.getElementById('questionsList');
            const questions = currentTeacher.questions;
            
            if (questions.length === 0) {
                container.innerHTML = '<p class="text-gray-600 italic">Belum ada soal</p>';
                return;
            }
            
            container.innerHTML = questions.map((q, index) => `
                <div class="bg-white p-4 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h5 class="font-semibold text-gray-800 mb-2">Soal ${index + 1}</h5>
                            <p class="text-gray-700 mb-2">${q.question}</p>
                            <div class="text-sm text-gray-600">
                                ${q.options.join(' | ')}
                            </div>
                            <div class="text-sm font-medium text-green-600 mt-1">
                                Jawaban: ${q.correct}
                            </div>
                        </div>
                        <button onclick="deleteQuestion(${q.id})" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                            Hapus
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function deleteQuestion(id) {
            if (!currentTeacher) return;
            
            if (confirm('Yakin ingin menghapus soal ini?')) {
                currentTeacher.questions = currentTeacher.questions.filter(q => q.id !== id);
                teachers[currentTeacher.username] = currentTeacher;
                localStorage.setItem('teachers', JSON.stringify(teachers));
                updateQuestionsList();
                showSuccessMessage('Soal berhasil dihapus!');
            }
        }

        function updateScoresList() {
            if (!currentTeacher) return;
            
            const container = document.getElementById('scoresList');
            const countElement = document.getElementById('scoresCount');
            const scores = currentTeacher.scores;
            
            countElement.textContent = `${scores.length} nilai tersimpan`;
            
            if (scores.length === 0) {
                container.innerHTML = '<p class="text-gray-600 italic">Belum ada data nilai</p>';
                return;
            }
            
            const sortedScores = [...scores].sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
            
            container.innerHTML = sortedScores.map((score, index) => `
                <div class="bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <h5 class="font-semibold text-gray-800">${score.studentName}</h5>
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Kelas ${score.studentClass}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">üìÖ ${score.date}</p>
                            <div class="text-xs text-gray-500 mt-1">
                                ID: ${score.id} ‚Ä¢ Soal: ${score.totalQuestions}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold ${score.score >= 75 ? 'text-green-600' : score.score >= 60 ? 'text-yellow-600' : 'text-red-600'}">${score.score}</div>
                            <div class="text-xs text-gray-500">${score.correctAnswers}/${score.totalQuestions} benar</div>
                            <div class="text-xs ${score.score >= 75 ? 'text-green-600' : score.score >= 60 ? 'text-yellow-600' : 'text-red-600'} font-medium">
                                ${score.score >= 75 ? '‚úÖ Lulus' : score.score >= 60 ? '‚ö†Ô∏è Cukup' : '‚ùå Kurang'}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // File Upload Functions
        function showUploadTab(tabType) {
            const fileTab = document.getElementById('fileTab');
            const manualTab = document.getElementById('manualTab');
            const fileUploadTab = document.getElementById('fileUploadTab');
            const manualInputTab = document.getElementById('manualInputTab');
            
            if (tabType === 'file') {
                fileTab.classList.add('bg-blue-600', 'text-white');
                fileTab.classList.remove('text-blue-600', 'hover:bg-blue-50');
                manualTab.classList.remove('bg-blue-600', 'text-white');
                manualTab.classList.add('text-blue-600', 'hover:bg-blue-50');
                
                fileUploadTab.classList.remove('hidden');
                manualInputTab.classList.add('hidden');
            } else {
                manualTab.classList.add('bg-blue-600', 'text-white');
                manualTab.classList.remove('text-blue-600', 'hover:bg-blue-50');
                fileTab.classList.remove('bg-blue-600', 'text-white');
                fileTab.classList.add('text-blue-600', 'hover:bg-blue-50');
                
                manualInputTab.classList.remove('hidden');
                fileUploadTab.classList.add('hidden');
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFileContent = e.target.result;
                document.getElementById('processBtn').disabled = false;
                
                const fileName = file.name;
                const fileSize = (file.size / 1024).toFixed(2) + ' KB';
                
                const uploadArea = document.querySelector('#fileUploadTab .bg-white');
                uploadArea.innerHTML = `
                    <div class="text-center">
                        <svg class="w-12 h-12 text-green-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-sm text-green-600 font-medium">${fileName}</p>
                        <p class="text-xs text-gray-500">${fileSize}</p>
                        <button onclick="document.getElementById('wordFile').click()" 
                                class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            Ganti File
                        </button>
                    </div>
                `;
            };
            
            reader.readAsText(file);
        }

        function processUploadedFile() {
            if (!uploadedFileContent || !currentTeacher) {
                alert('Belum ada file yang diupload atau belum login!');
                return;
            }
            
            const processBtn = document.getElementById('processBtn');
            const originalText = processBtn.innerHTML;
            processBtn.innerHTML = '‚è≥ Memproses...';
            processBtn.disabled = true;
            
            try {
                const parsedQuestions = parseQuestionFile(uploadedFileContent);
                
                if (parsedQuestions.length === 0) {
                    alert('Tidak ada soal yang berhasil diparse. Pastikan format file sesuai template!');
                    processBtn.innerHTML = originalText;
                    processBtn.disabled = false;
                    return;
                }
                
                // Replace all questions for current teacher
                currentTeacher.questions = [];
                
                parsedQuestions.forEach((q, index) => {
                    const newQuestion = {
                        id: Date.now() + index,
                        question: q.question,
                        options: q.options,
                        correct: q.correct
                    };
                    currentTeacher.questions.push(newQuestion);
                });
                
                // Save to localStorage
                teachers[currentTeacher.username] = currentTeacher;
                localStorage.setItem('teachers', JSON.stringify(teachers));
                
                updateQuestionsList();
                
                processBtn.innerHTML = '‚úÖ Tersimpan!';
                processBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                processBtn.classList.add('bg-green-500');
                
                showSuccessMessage(`${parsedQuestions.length} soal berhasil diupload!`);
                
                setTimeout(() => {
                    resetUploadUI();
                }, 2000);
                
            } catch (error) {
                console.error('Error parsing file:', error);
                alert('Error parsing file: ' + error.message);
                processBtn.innerHTML = originalText;
                processBtn.disabled = false;
            }
        }

        function parseQuestionFile(content) {
            const questions = [];
            const lines = content.split('\n').map(line => line.trim()).filter(line => line);
            
            let currentQuestion = null;
            let i = 0;
            
            while (i < lines.length) {
                const line = lines[i];
                
                if (!line.match(/^[ABCD]\.\s/) && !line.toLowerCase().includes('kunci jawaban')) {
                    currentQuestion = {
                        question: line,
                        options: [],
                        correct: ''
                    };
                    
                    i++;
                    
                    while (i < lines.length && currentQuestion.options.length < 4) {
                        const optionLine = lines[i];
                        
                        if (optionLine.match(/^[ABCD]\.\s/)) {
                            const optionText = optionLine.substring(3).trim();
                            currentQuestion.options.push(optionText);
                            i++;
                        } else if (optionLine.toLowerCase().includes('kunci jawaban')) {
                            break;
                        } else {
                            if (currentQuestion.options.length === 0) {
                                currentQuestion.question += ' ' + optionLine;
                            }
                            i++;
                        }
                    }
                    
                    while (i < lines.length) {
                        const answerLine = lines[i];
                        
                        if (answerLine.toLowerCase().includes('kunci jawaban')) {
                            const answerMatch = answerLine.match(/[ABCD]/i);
                            if (answerMatch) {
                                currentQuestion.correct = answerMatch[0].toUpperCase();
                            }
                            i++;
                            break;
                        } else if (answerLine.match(/^[ABCD]\.?$/i)) {
                            currentQuestion.correct = answerLine.replace('.', '').toUpperCase();
                            i++;
                            break;
                        }
                        i++;
                    }
                    
                    if (currentQuestion.question && 
                        currentQuestion.options.length === 4 && 
                        currentQuestion.correct && 
                        ['A', 'B', 'C', 'D'].includes(currentQuestion.correct)) {
                        questions.push(currentQuestion);
                    }
                } else {
                    i++;
                }
            }
            
            return questions;
        }

        function resetUploadUI() {
            document.getElementById('wordFile').value = '';
            uploadedFileContent = '';
            
            const uploadArea = document.querySelector('#fileUploadTab .bg-white');
            uploadArea.innerHTML = `
                <div class="text-center">
                    <svg class="w-12 h-12 text-blue-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <p class="text-sm text-gray-600 mb-2">Upload file Microsoft Word (.docx)</p>
                    <input type="file" id="wordFile" accept=".docx,.doc,.txt" 
                           class="hidden" onchange="handleFileUpload(event)">
                    <button onclick="document.getElementById('wordFile').click()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                        Pilih File
                    </button>
                </div>
            `;
            
            const processBtn = document.getElementById('processBtn');
            processBtn.innerHTML = 'üì§ Proses File';
            processBtn.classList.remove('bg-green-500');
            processBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            processBtn.disabled = true;
        }

        // Export Functions
        function exportScoresJSON() {
            if (!currentTeacher || currentTeacher.scores.length === 0) {
                alert('Belum ada data nilai untuk diekspor!');
                return;
            }

            try {
                const exportData = {
                    exportInfo: {
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleString('id-ID'),
                        teacher: currentTeacher.fullName,
                        subject: currentTeacher.subject,
                        totalScores: currentTeacher.scores.length,
                        exportFormat: 'JSON'
                    },
                    scores: currentTeacher.scores.map(score => ({
                        id: score.id,
                        studentName: score.studentName,
                        studentClass: score.studentClass,
                        score: score.score,
                        correctAnswers: score.correctAnswers,
                        totalQuestions: score.totalQuestions,
                        date: score.date,
                        timestamp: score.timestamp,
                        status: score.score >= 75 ? 'Lulus' : score.score >= 60 ? 'Cukup' : 'Kurang'
                    })),
                    summary: {
                        averageScore: Math.round(currentTeacher.scores.reduce((sum, s) => sum + s.score, 0) / currentTeacher.scores.length),
                        highestScore: Math.max(...currentTeacher.scores.map(s => s.score)),
                        lowestScore: Math.min(...currentTeacher.scores.map(s => s.score)),
                        passCount: currentTeacher.scores.filter(s => s.score >= 75).length,
                        failCount: currentTeacher.scores.filter(s => s.score < 60).length,
                        totalStudents: currentTeacher.scores.length
                    }
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `rekap-nilai-${currentTeacher.subject}-${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showSuccessMessage(`Data ${currentTeacher.scores.length} nilai berhasil diekspor ke JSON!`);
                
            } catch (error) {
                console.error('Error exporting JSON:', error);
                alert('Terjadi kesalahan saat mengekspor data JSON!');
            }
        }

        function exportScoresExcel() {
            if (!currentTeacher || currentTeacher.scores.length === 0) {
                alert('Belum ada data nilai untuk diekspor!');
                return;
            }

            try {
                let csvContent = '';
                
                csvContent += `DETAIL NILAI SISWA\n`;
                csvContent += `Guru: ${currentTeacher.fullName} - ${currentTeacher.subject}\n`;
                csvContent += `Tanggal Ekspor: ${new Date().toLocaleString('id-ID')}\n\n`;
                
                csvContent += `No,ID Ujian,Nama Siswa,Kelas,Nilai,Benar,Total Soal,Status,Tanggal Ujian\n`;
                
                const sortedScores = [...currentTeacher.scores].sort((a, b) => b.score - a.score);
                
                sortedScores.forEach((score, index) => {
                    const status = score.score >= 75 ? 'Lulus' : score.score >= 60 ? 'Cukup' : 'Tidak Lulus';
                    csvContent += `${index + 1},${score.id},"${score.studentName}",${score.studentClass},${score.score},${score.correctAnswers},${score.totalQuestions},${status},"${score.date}"\n`;
                });

                const dataBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `detail-nilai-${currentTeacher.subject}-${new Date().toISOString().split('T')[0]}.csv`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showSuccessMessage(`Detail nilai ${currentTeacher.scores.length} siswa berhasil diekspor!`);
                
            } catch (error) {
                console.error('Error exporting Excel:', error);
                alert('Terjadi kesalahan saat mengekspor data Excel!');
            }
        }

        // Backup and Restore Functions
        function backupTeacherData() {
            if (!currentTeacher) {
                alert('Belum login sebagai guru!');
                return;
            }

            try {
                const backupData = {
                    backupInfo: {
                        version: '1.0',
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleString('id-ID'),
                        description: 'Backup data guru ujian online',
                        teacher: currentTeacher.fullName,
                        subject: currentTeacher.subject,
                        username: currentTeacher.username
                    },
                    teacherData: {
                        ...currentTeacher,
                        password: undefined // Don't backup password for security
                    },
                    statistics: {
                        totalScores: currentTeacher.scores.length,
                        totalQuestions: currentTeacher.questions.length,
                        averageScore: currentTeacher.scores.length > 0 ? Math.round(currentTeacher.scores.reduce((sum, s) => sum + s.score, 0) / currentTeacher.scores.length) : 0,
                        highestScore: currentTeacher.scores.length > 0 ? Math.max(...currentTeacher.scores.map(s => s.score)) : 0,
                        lowestScore: currentTeacher.scores.length > 0 ? Math.min(...currentTeacher.scores.map(s => s.score)) : 0
                    }
                };

                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `backup-guru-${currentTeacher.username}-${new Date().toISOString().split('T')[0]}.json`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showSuccessMessage(`Backup data guru berhasil dibuat! File berisi ${currentTeacher.scores.length} nilai dan ${currentTeacher.questions.length} soal.`);
                
            } catch (error) {
                console.error('Error creating backup:', error);
                alert('Terjadi kesalahan saat membuat backup!');
            }
        }

        function showRestoreModal() {
            document.getElementById('restoreDataModal').classList.remove('hidden');
            document.getElementById('restoreFile').value = '';
            document.getElementById('restorePreview').classList.add('hidden');
            document.getElementById('confirmRestoreBtn').disabled = true;
            restoreData = null;
        }

        function closeRestoreModal() {
            document.getElementById('restoreDataModal').classList.add('hidden');
            restoreData = null;
        }

        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.teacherData || !data.backupInfo) {
                        throw new Error('File backup tidak valid atau rusak');
                    }
                    
                    restoreData = data;
                    
                    const previewDiv = document.getElementById('restorePreview');
                    const infoDiv = document.getElementById('restoreInfo');
                    
                    const backupDate = data.backupInfo.date || 'Tidak diketahui';
                    const teacherName = data.backupInfo.teacher || 'Tidak diketahui';
                    const subject = data.backupInfo.subject || 'Tidak diketahui';
                    const scoresCount = data.teacherData.scores ? data.teacherData.scores.length : 0;
                    const questionsCount = data.teacherData.questions ? data.teacherData.questions.length : 0;
                    
                    infoDiv.innerHTML = `
                        <div class="space-y-1">
                            <div><strong>Tanggal Backup:</strong> ${backupDate}</div>
                            <div><strong>Guru:</strong> ${teacherName}</div>
                            <div><strong>Mata Pelajaran:</strong> ${subject}</div>
                            <div><strong>Jumlah Nilai:</strong> ${scoresCount} data</div>
                            <div><strong>Jumlah Soal:</strong> ${questionsCount} soal</div>
                        </div>
                    `;
                    
                    previewDiv.classList.remove('hidden');
                    document.getElementById('confirmRestoreBtn').disabled = false;
                    
                } catch (error) {
                    console.error('Error reading backup file:', error);
                    alert('File backup tidak valid atau rusak: ' + error.message);
                    restoreData = null;
                }
            };
            
            reader.readAsText(file);
        }

        function confirmRestore() {
            if (!restoreData || !currentTeacher) {
                alert('Tidak ada data untuk direstore atau belum login!');
                return;
            }
            
            const scoresCount = restoreData.teacherData.scores ? restoreData.teacherData.scores.length : 0;
            const questionsCount = restoreData.teacherData.questions ? restoreData.teacherData.questions.length : 0;
            
            if (!confirm(`Yakin ingin restore data?\n\nData yang akan direstore:\n- ${scoresCount} nilai siswa\n- ${questionsCount} soal ujian\n\nData saat ini akan ditimpa!`)) {
                return;
            }
            
            try {
                // Restore data to current teacher (keep password and username)
                if (restoreData.teacherData.scores) {
                    currentTeacher.scores = restoreData.teacherData.scores;
                }
                
                if (restoreData.teacherData.questions) {
                    currentTeacher.questions = restoreData.teacherData.questions;
                }
                
                // Update teacher data in storage
                teachers[currentTeacher.username] = currentTeacher;
                localStorage.setItem('teachers', JSON.stringify(teachers));
                
                // Update displays
                updateScoresList();
                updateQuestionsList();
                
                closeRestoreModal();
                showSuccessMessage(`Data berhasil direstore! ${scoresCount} nilai dan ${questionsCount} soal telah dipulihkan.`);
                
            } catch (error) {
                console.error('Error restoring data:', error);
                alert('Terjadi kesalahan saat restore data: ' + error.message);
            }
        }

        // Utility Functions
        function saveAllQuestions() {
            if (!currentTeacher || currentTeacher.questions.length === 0) {
                alert('Belum ada soal untuk disimpan!');
                return;
            }
            
            teachers[currentTeacher.username] = currentTeacher;
            localStorage.setItem('teachers', JSON.stringify(teachers));
            
            showSuccessMessage(`${currentTeacher.questions.length} soal berhasil disimpan!`);
        }

        function clearAllQuestions() {
            if (!currentTeacher || currentTeacher.questions.length === 0) {
                alert('Tidak ada soal untuk dihapus!');
                return;
            }
            
            if (confirm(`Yakin ingin menghapus semua ${currentTeacher.questions.length} soal?\n\nTindakan ini tidak dapat dibatalkan!`)) {
                currentTeacher.questions = [];
                teachers[currentTeacher.username] = currentTeacher;
                localStorage.setItem('teachers', JSON.stringify(teachers));
                updateQuestionsList();
                showSuccessMessage('Semua soal berhasil dihapus!');
            }
        }

        function clearScores() {
            if (!currentTeacher || currentTeacher.scores.length === 0) {
                alert('Tidak ada data nilai untuk dihapus!');
                return;
            }
            
            if (confirm(`Yakin ingin menghapus semua ${currentTeacher.scores.length} data nilai?\n\nTindakan ini tidak dapat dibatalkan!`)) {
                currentTeacher.scores = [];
                teachers[currentTeacher.username] = currentTeacher;
                localStorage.setItem('teachers', JSON.stringify(teachers));
                updateScoresList();
                showSuccessMessage('Semua data nilai berhasil dihapus!');
            }
        }

        function logoutTeacher() {
            if (confirm('Yakin ingin logout dari panel guru?')) {
                currentTeacher = null;
                showHome();
                showSuccessMessage('Berhasil logout dari panel guru!');
            }
        }

        // Password and Header Functions
        function showChangePassword() {
            document.getElementById('changePasswordModal').classList.remove('hidden');
            document.getElementById('oldPasswordInput').focus();
            document.getElementById('passwordError').classList.add('hidden');
        }

        function closeChangePassword() {
            document.getElementById('changePasswordModal').classList.add('hidden');
            document.getElementById('changePasswordForm').reset();
            document.getElementById('passwordError').classList.add('hidden');
        }

        function showHeaderEditor() {
            document.getElementById('examTitleInput').value = headerSettings.examTitle;
            document.getElementById('schoolNameInput').value = headerSettings.schoolName;
            document.getElementById('academicYearInput').value = headerSettings.academicYear;
            document.getElementById('headerEditorModal').classList.remove('hidden');
        }

        function closeHeaderEditor() {
            document.getElementById('headerEditorModal').classList.add('hidden');
        }

        function updateHeader() {
            const headerTitle = document.querySelector('header h1');
            const headerSchool = document.querySelector('header h2');
            const headerYear = document.querySelector('header p');
            
            if (headerTitle) headerTitle.textContent = headerSettings.examTitle;
            if (headerSchool) headerSchool.textContent = headerSettings.schoolName;
            if (headerYear) headerYear.textContent = headerSettings.academicYear;
        }

        // Form Handlers
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentTeacher) return;
            
            const oldPassword = document.getElementById('oldPasswordInput').value;
            const newPassword = document.getElementById('newPasswordInput').value;
            const confirmPassword = document.getElementById('confirmPasswordInput').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (oldPassword !== currentTeacher.password) {
                errorDiv.textContent = 'Password lama tidak benar!';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPassword.length < 6) {
                errorDiv.textContent = 'Password baru minimal 6 karakter!';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'Konfirmasi password tidak cocok!';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPassword === oldPassword) {
                errorDiv.textContent = 'Password baru harus berbeda dari password lama!';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            currentTeacher.password = newPassword;
            teachers[currentTeacher.username] = currentTeacher;
            localStorage.setItem('teachers', JSON.stringify(teachers));
            
            closeChangePassword();
            showSuccessMessage('Password berhasil diubah!');
        });

        document.getElementById('headerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            headerSettings.examTitle = document.getElementById('examTitleInput').value.trim();
            headerSettings.schoolName = document.getElementById('schoolNameInput').value.trim();
            headerSettings.academicYear = document.getElementById('academicYearInput').value.trim();
            
            localStorage.setItem('headerSettings', JSON.stringify(headerSettings));
            updateHeader();
            closeHeaderEditor();
            showSuccessMessage('Header berhasil diperbarui!');
        });

        function togglePasswordVisibility(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
                `;
            } else {
                input.type = 'password';
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            }
        }

        // Status Update Functions
        function updateHomeStatus() {
            const teacherCount = Object.keys(teachers).length;
            const totalQuestions = Object.values(teachers).reduce((sum, teacher) => sum + teacher.questions.length, 0);
            const totalScores = Object.values(teachers).reduce((sum, teacher) => sum + teacher.scores.length, 0);
            
            document.getElementById('teacherCount').textContent = teacherCount;
            document.getElementById('totalSystemData').textContent = totalQuestions + totalScores;
            
            const statusElement = document.getElementById('systemStatus');
            if (teacherCount === 0) {
                statusElement.textContent = 'Belum ada guru yang terdaftar';
                statusElement.className = 'text-gray-600';
            } else {
                statusElement.textContent = `${teacherCount} guru terdaftar dengan ${totalQuestions} soal total`;
                statusElement.className = 'text-green-600 font-medium';
            }
        }

        function showSuccessMessage(message) {
            const overlay = document.createElement('div');
            overlay.className = 'fixed top-4 right-4 z-50';
            overlay.innerHTML = `
                <div class="bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full opacity-0 transition-all duration-300">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span>${message}</span>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                const notification = overlay.querySelector('div');
                notification.classList.remove('translate-x-full', 'opacity-0');
                notification.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            setTimeout(() => {
                const notification = overlay.querySelector('div');
                notification.classList.add('translate-x-full', 'opacity-0');
                notification.classList.remove('translate-x-0', 'opacity-100');
                
                setTimeout(() => {
                    overlay.remove();
                }, 300);
            }, 4000);
        }

        // Initialize System
        function initializeSystem() {
            updateHeader();
            updateHomeStatus();
            
            // Load existing data
            console.log(`‚úÖ Sistem Multi-Guru siap! ${Object.keys(teachers).length} guru terdaftar`);
            
            // Show welcome message if no teachers exist
            if (Object.keys(teachers).length === 0) {
                setTimeout(() => {
                    console.log('üí° Tip: Daftar akun guru pertama untuk mulai menggunakan sistem');
                }, 1000);
            }
        }

        // Start the system
        initializeSystem();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97be36dc44179ccb',t:'MTc1NzMzMjA4MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
